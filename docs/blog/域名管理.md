# 域名管理

## 一、证书自动化简述

1.域名后台添加泛域名解析（*.joshzhong.top）

2.[登陆Freessl](https://freessl.cn/)，添加域名授权（选择CNAME类型），

3.复制授权验证信息，登陆域名后台，将授权添加解析记录

```
主机记录: _acme-challenge.upload

记录类型: CNAME

记录值: 6dd9e7kwneceow1o4qnl.dcv2.httpsauto.com

检测状态: 待配置DCV
```

4.添加后，Freessl仍显示（待配置DCV），需要点击申请ACME客户端证书，点击后就会显示【已通过DCV检测】，如果需要申请复制执行即可（参考步骤6）

5.服务器安装.acme客户端

```bash
mkdir -p /data/acme
cd /data/acme
git clone https://github.com/acmesh-official/acme.sh.git

cd acme.sh
./acme.sh --install -m xxxx@qq.com		# 指定一个邮箱
```

6.执行申请证书命令

```bash
acme.sh --issue -d pic.joshzhong.top --dns dns_dp --server https://acme.freessl.cn/v2/DV90/directory/xxxxx --force
```

## 二、证书文件配置

```bash
cat > domain.json <<'EOF'
{
  "music.joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/music.joshzhong.top/music.joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/music.joshzhong.top/music.joshzhong.top.key",
    "app_type": "nginx"
  },
  "reader.joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/reader.joshzhong.top/reader.joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/reader.joshzhong.top/reader.joshzhong.top.key",
    "app_type": "nginx"
  },
  "domain.joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/domain.joshzhong.top/domain.joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/domain.joshzhong.top/domain.joshzhong.top.key",
    "app_type": "nginx"
  },
  "joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/joshzhong.top/joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/joshzhong.top/joshzhong.top.key",
    "app_type": "nginx"
  },
  "pic.joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/pic.joshzhong.top/pic.joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/pic.joshzhong.top/pic.joshzhong.top.key",
    "app_type": "nginx"
  },
  "chat.joshzhong.top": {
    "host": "159.75.238.93",
    "port": 443,
    "cert_file": "/usr/local/nginx/cert/chat.joshzhong.top/chat.joshzhong.top.pem",
    "key_file": "/usr/local/nginx/cert/chat.joshzhong.top/chat.joshzhong.top.key",
    "app_type": "nginx"
  }
}
EOF
```

