user nginx;
worker_processes auto;
worker_cpu_affinity auto;
pid /run/nginx/nginx.pid;
load_module /usr/lib/nginx/modules/ngx_stream_module.so;
error_log logs/error.log;
events {
  worker_connections 204800;
  use epoll;
  multi_accept on;
}
http {
  include mime.types;
  default_type application/octet-stream;

  # 新增的 server 块处理所有通过 IP 或未配置 HTTPS 的 HTTP 访问
  server {
    listen 80 default_server;
    listen 443 ssl default_server;
    server_name _;

    ssl_certificate /home/nginxWebUI/cert/none/none-ca.crt;
    ssl_certificate_key /home/nginxWebUI/cert/none/none-ca.key;
    ssl_protocols TLSv1.2 TLSv1.3;

    error_page 400 /400.html;
    
    location = /400.html {
      root /home/nginxWebUI/html;
      internal;
    }

    location / {
      return 400;
    }
  }

  server {
    server_name chat.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/chat.joshzhong.top/chat.joshzhong.top.pem;
    ssl_certificate_key /home/nginxWebUI/cert/chat.joshzhong.top/chat.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8299;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name nginx.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/nginx.joshzhong.top/fullchain.cer;
    ssl_certificate_key /home/nginxWebUI/cert/nginx.joshzhong.top/nginx.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8080;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name jupyter.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/jupyter.joshzhong.top/jupyter.joshzhong.top.pem;
    ssl_certificate_key /home/nginxWebUI/cert/jupyter.joshzhong.top/jupyter.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8236;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name lobehub.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/lobehub.joshzhong.top/lobehub.joshzhong.top.pem;
    ssl_certificate_key /home/nginxWebUI/cert/lobehub.joshzhong.top/lobehub.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8300;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name domain.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/domain.joshzhong.top/domain.joshzhong.top.pem;
    ssl_certificate_key /home/nginxWebUI/cert/domain.joshzhong.top/domain.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8000;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name nas.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/nas.joshzhong.top/nas.joshzhong.top.cer;
    ssl_certificate_key /home/nginxWebUI/cert/nas.joshzhong.top/nas.joshzhong.top.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:5000;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }

  server {
    server_name blog.joshzhong.top;
    listen 443 ssl http2;
    ssl_certificate /home/nginxWebUI/cert/blog.joshzhong.top/full_chain.pem;
    ssl_certificate_key /home/nginxWebUI/cert/blog.joshzhong.top/private.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    location / {
      proxy_pass http://120.78.156.217:8090;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $http_host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }
  }
}
